services:
  api:
    # Use pre-built image if IMAGE is set, otherwise build from Dockerfile
    image: ${IMAGE:-}
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    environment:
      - ADMIN_PASSWORD=test-admin-password
      - SESSION_SECRET=test-session-secret-min-32-chars-long
      - SKIP_LITESTREAM=true
      - DB_PATH=/app/apps/api/data/captures.db
    ports:
      - "3333:3000"
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000/health"]
      interval: 2s
      timeout: 5s
      retries: 15
      start_period: 5s
